{"version":3,"sources":["App.js","index.js"],"names":["CaptchaRequired","body","Error","CaptchaWrong","YandexMusicApi","oauth_url","client_id","client_secret","generate_token_by_username_and_password","username","password","x_captcha_answer","x_captcha_key","a","url","data","grant_type","post","then","resp","json","serialize","obj","str","p","hasOwnProperty","push","encodeURIComponent","join","handleCaptcha","errorMessage","includes","fetch","method","ok","message","error_description","App","props","api","handleChange","target","name","value","setState","state","handleSubmit","event","preventDefault","x_captcha_url","undefined","token","alert","catch","error","this","Container","Form","Group","controlId","Label","column","Control","onChange","type","placeholder","InputGroup","className","Prepend","Image","fluid","src","as","Append","Button","onClick","variant","block","Component","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.8d439da3.chunk.js","sourcesContent":["import React, {Component} from 'react';\nimport $ from 'jquery';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport {Image, Button, Container, Form, InputGroup} from 'react-bootstrap'\n\n\nclass CaptchaRequired extends Error {\n    constructor(body) {\n        super();\n        this.body = body\n    }\n}\n\nclass CaptchaWrong extends Error {\n    constructor(body) {\n        super();\n        this.body = body\n    }\n}\n\n/**\n * Reference: https://github.com/MarshalX/yandex-music-api/blob/952145c3b8431385f2fe8273d52d8eb4e49fcceb/yandex_music/client.py#L89\n */\nclass YandexMusicApi {\n    oauth_url = 'https://oauth.yandex.ru';\n    client_id = '23cabbbdc6cd418abb4b39c32c41195d';\n    client_secret = '53bc75238f0c4d08a118e51fe9203300';\n\n    generate_token_by_username_and_password = async (username, password, x_captcha_answer, x_captcha_key) => {\n        const url = `${this.oauth_url}/token`;\n\n        let data = {\n            grant_type: 'password',\n            client_id: this.client_id,\n            client_secret: this.client_secret,\n            username: username,\n            password: password\n        };\n\n        if (x_captcha_answer && x_captcha_key) {\n            data = {...data, x_captcha_answer, x_captcha_key}\n        }\n\n        return await this.post(url, data)\n            .then(resp => resp.json())\n            .then(json => json['access_token']);\n    };\n\n    serialize = (obj) => {\n        let str = [];\n        for (let p in obj)\n            if (obj.hasOwnProperty(p)) {\n                str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\n            }\n        return str.join(\"&\");\n    };\n\n    handleCaptcha = (errorMessage, json) => {\n        if (errorMessage.includes('Wrong')) {\n            throw new CaptchaWrong(json);\n        } else {\n            throw new CaptchaRequired(json);\n        }\n    };\n\n    post = (url, data) => {\n        return fetch(url, {\n            method: 'POST',\n            body: this.serialize(data)\n        }).then(resp => {\n            if (!resp.ok) {\n                return resp.json().then(json => {\n                    let message = json.error_description || 'Unknown HTTP Error';\n                    if (message.includes('CAPTCHA')) {\n                        return this.handleCaptcha(message, json);\n                    } else {\n                        throw new Error(message);\n                    }\n                });\n            }\n            return resp;\n        });\n    };\n}\n\nclass App extends Component {\n\n    api = new YandexMusicApi();\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            username: '',\n            password: ''\n        };\n    }\n\n    handleChange = ({target: {name, value}}) => {\n        this.setState({...this.state, [name]: value})\n    };\n\n    handleSubmit = event => {\n        event.preventDefault();\n\n        this.setState({\n            ...this.state,\n            x_captcha_url: undefined,\n            x_captcha_key: undefined\n        });\n\n        const {username, password, x_captcha_answer, x_captcha_key} = this.state;\n        this.api.generate_token_by_username_and_password(username, password, x_captcha_answer, x_captcha_key).then(token => {\n            alert(token);\n        }).catch(error => {\n            if (error instanceof CaptchaRequired || error instanceof CaptchaWrong) {\n                const {x_captcha_url, x_captcha_key} = error.body;\n                this.setState({\n                    ...this.state,\n                    x_captcha_url,\n                    x_captcha_key\n                })\n            } else {\n                alert(`An error has occurred: ${error}`)\n            }\n        })\n    };\n\n    render() {\n        const {x_captcha_url} = this.state;\n        return (\n            <Container>\n                <Form>\n                    <Form.Group controlId=\"formBasicEmail\">\n                        <Form.Label column={false}>Введите логин, почту или телефон:</Form.Label>\n                        <Form.Control name=\"username\" onChange={this.handleChange}\n                                      type=\"email\" placeholder=\"Введите логин, почту или телефон\"/>\n                    </Form.Group>\n\n                    <Form.Group controlId=\"formBasicPassword\">\n                        <Form.Label column={false}>Введите пароль</Form.Label>\n                        <Form.Control name=\"password\" onChange={this.handleChange}\n                                      type=\"password\" placeholder=\"Введите пароль\"/>\n                    </Form.Group>\n\n                    {x_captcha_url &&\n                    <InputGroup className=\"mb-3\">\n                        <InputGroup.Prepend>\n                            <Image fluid src={x_captcha_url}/>\n                        </InputGroup.Prepend>\n                        <Form.Control name=\"x_captcha_answer\" onChange={this.handleChange} as=\"textarea\"\n                                     type=\"plain\" placeholder=\"Введите капчу\"/>\n                        <InputGroup.Append>\n                            <Button type=\"submit\" onClick={this.handleSubmit}>\n                                Обновить\n                            </Button>\n                        </InputGroup.Append>\n                    </InputGroup>\n                    }\n\n                    <Button variant=\"primary\" type=\"submit\" block onClick={this.handleSubmit}>\n                        Войти\n                    </Button>\n                </Form>\n            </Container>\n        );\n    }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}